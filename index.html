<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cobblemon Lucky Wheel</title>
    <style>
        /* ... (all previous CSS remains the same) ... */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #eee;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: #0f1419;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            overflow: hidden;
            border: 1px solid #1e2936;
        }

        .header {
            background: linear-gradient(135deg, #1e2936 0%, #2d3748 100%);
            color: #fff;
            padding: 30px;
            text-align: center;
            border-bottom: 2px solid #3d5a80;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.8;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            padding: 30px;
        }

        .wheel-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-width: 0;
        }

        .wheel-type-selector {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .wheel-type-btn {
            flex: 1;
            padding: 15px 30px;
            border: 2px solid #3d5a80;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            background: #1a1f2e;
            color: #98c1d9;
        }

        .wheel-type-btn.active {
            background: linear-gradient(135deg, #3d5a80 0%, #5a7a9a 100%);
            color: white;
            border-color: #5a7a9a;
            box-shadow: 0 5px 15px rgba(61, 90, 128, 0.4);
        }

        .roulette-container {
            background: #1a1f2e;
            border: 2px solid #3d5a80;
            border-radius: 15px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .roulette-wrapper {
            position: relative;
            width: 100%;
            height: 220px;
            overflow: hidden;
            border: 3px solid #3d5a80;
            border-radius: 10px;
            background: #0f1419;
        }

        .roulette-selector {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(180deg, #e63946 0%, #ff006e 100%);
            transform: translateX(-50%);
            z-index: 10;
            box-shadow: 0 0 20px rgba(230, 57, 70, 0.8);
        }

        .roulette-selector::before {
            content: '‚ñº';
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            color: #e63946;
            font-size: 24px;
            text-shadow: 0 0 10px rgba(230, 57, 70, 0.8);
        }

        .roulette-track {
            display: flex;
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            height: 100%;
            align-items: center;
            position: relative;
        }

        .roulette-item {
            flex: 0 0 120px;
            height: 160px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #1e2936;
            border: 2px solid #3d5a80;
            border-radius: 8px;
            margin: 0 5px;
            padding: 10px;
            box-sizing: border-box;
            flex-shrink: 0;
        }

        .roulette-item.shiny {
            background: linear-gradient(135deg, #ffd60a 0%, #ffb703 100%);
            border-color: #ffd60a;
            box-shadow: 0 0 20px rgba(255, 214, 10, 0.5);
        }

        .roulette-item.netherstar {
            background: linear-gradient(135deg, #4cc9f0 0%, #4361ee 100%);
            border-color: #4cc9f0;
            box-shadow: 0 0 20px rgba(76, 201, 240, 0.5), 0 0 30px rgba(76, 201, 240, 0.3);
            position: relative;
            overflow: hidden;
        }

        .roulette-item.netherstar::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            animation: glint 3s infinite linear;
        }

        .roulette-item.ender {
            background: linear-gradient(135deg, #7209b7 0%, #3a0ca3 100%);
            border-color: #9d4edd;
            box-shadow: 0 0 20px rgba(157, 78, 221, 0.5), 0 0 30px rgba(157, 78, 221, 0.3);
            position: relative;
            overflow: hidden;
        }

        .roulette-item.ender::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            animation: glint 3s infinite linear;
        }

        .roulette-item.masterball {
            background: linear-gradient(135deg, #ff595e 0%, #ff9f1c 100%);
            border-color: #ff9f1c;
            box-shadow: 0 0 20px rgba(255, 159, 28, 0.5);
        }

        .roulette-item.cherish {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            border-color: #ff6b6b;
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.5);
        }

        .roulette-item.golden {
            background: linear-gradient(135deg, #ffd700 0%, #ffb703 100%);
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        @keyframes glint {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .roulette-item img {
            width: 64px;
            height: 64px;
            image-rendering: pixelated;
            margin-bottom: 8px;
        }

        .roulette-item-name {
            font-size: 0.9em;
            font-weight: 600;
            color: #98c1d9;
            text-align: center;
            word-wrap: break-word;
            max-width: 100%;
        }

        .roulette-item.shiny .roulette-item-name {
            color: #000;
            text-shadow: 0 0 5px rgba(255, 214, 10, 0.8);
        }

        .roulette-item.netherstar .roulette-item-name,
        .roulette-item.ender .roulette-item-name,
        .roulette-item.masterball .roulette-item-name,
        .roulette-item.cherish .roulette-item-name {
            color: white;
            text-shadow: 0 0 5px rgba(157, 78, 221, 0.8);
        }

        .roulette-item.golden .roulette-item-name {
            color: #000;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.8);
        }

        .shiny-badge {
            font-size: 0.7em;
            color: #000;
            font-weight: 700;
            background: #ffd60a;
            padding: 2px 6px;
            border-radius: 8px;
            margin-top: 4px;
        }

        .item-count {
            font-size: 0.8em;
            color: #98c1d9;
            margin-top: 4px;
        }

        .spin-button {
            padding: 20px 50px;
            font-size: 1.3em;
            font-weight: 600;
            background: linear-gradient(135deg, #e63946 0%, #ff006e 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(230, 57, 70, 0.4);
            align-self: center;
            margin-top: 10px;
        }

        .spin-button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(230, 57, 70, 0.6);
        }

        .spin-button:disabled {
            background: #2d3748;
            cursor: not-allowed;
            box-shadow: none;
        }

        .sidebar {
            display: flex;
            flex-direction:column;
            gap: 20px;
        }

        .token-display {
            background: linear-gradient(135deg, #2d3748 0%, #3d5a80 100%);
            padding: 25px;
            border-radius: 15px;
            color: white;
            text-align: center;
            border: 1px solid #3d5a80;
        }

        .token-display h3 {
            font-size: 1.3em;
            margin-bottom: 15px;
        }

        .token-count {
            font-size: 3em;
            font-weight: bold;
            margin: 10px 0;
            color: #98c1d9;
        }

        .trade-info {
            margin-top: 15px;
            padding: 15px;
            background: rgba(26, 31, 46, 0.8);
            border-radius: 10px;
            border: 1px solid #3d5a80;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .trade-info h4 {
            color: #98c1d9;
            margin-bottom: 8px;
        }

        /* Login Form Styles */
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        .login-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #3d5a80;
            border-radius: 10px;
            font-size: 1em;
            background: #1a1f2e;
            color: #98c1d9;
        }

        .login-input:focus {
            outline: none;
            border-color: #5a7a9a;
        }

        .login-button {
            padding: 12px;
            background: linear-gradient(135deg, #3d5a80 0%, #5a7a9a 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(61, 90, 128, 0.4);
        }

        .logout-button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #e63946 0%, #b91d43 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
            align-self: center;
        }

        .logout-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(230, 57, 70, 0.4);
        }

        .player-info {
            margin-top: 15px;
            padding: 15px;
            background: rgba(26, 31, 46, 0.8);
            border-radius: 10px;
            border: 1px solid #3d5a80;
        }

        .player-name {
            font-size: 1.4em;
            font-weight: bold;
            color: #98c1d9;
            margin-bottom: 5px;
            text-align: center;
        }

        .player-subtitle {
            font-size: 0.9em;
            opacity: 0.8;
            text-align: center;
        }

        .login-error {
            color: #e63946;
            font-size: 0.9em;
            margin-top: 5px;
            text-align: center;
            display: none;
        }

        .refresh-button {
            width: 100%;
            padding: 12px;
            background: #1a1f2e;
            color: #98c1d9;
            border: 2px solid #3d5a80;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .refresh-button:hover {
            background: #3d5a80;
            color: white;
        }

        .pokemon-list {
            background: #1a1f2e;
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #3d5a80;
        }

        .pokemon-list h3 {
            margin-bottom: 15px;
            color: #98c1d9;
            font-size: 1.3em;
        }

        .pokemon-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .pokemon-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #0f1419;
            border-radius: 8px;
            font-size: 0.9em;
            transition: all 0.2s;
            border: 1px solid #2d3748;
            color: #98c1d9;
        }

        .pokemon-item:hover {
            transform: translateX(5px);
            border-color: #3d5a80;
        }

        .pokemon-sprite {
            width: 40px;
            height: 40px;
            image-rendering: pixelated;
        }

        .shiny-info {
            background: linear-gradient(135deg, #ffd60a 0%, #ffb703 100%);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: 600;
            color: #000;
            box-shadow: 0 0 20px rgba(255, 214, 10, 0.3);
        }

        .result-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1a1f2e;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.8);
            z-index: 1000;
            text-align: center;
            min-width: 400px;
            border: 2px solid #3d5a80;
            max-width: 500px;
            width: 90%;
        }

        .result-popup.show {
            display: block;
            animation: popupAppear 0.5s ease;
        }

        .result-popup.shiny {
            background: linear-gradient(135deg, #ffd60a 0%, #ffb703 100%);
            border-color: #ffd60a;
        }

        .result-popup.netherstar {
            background: linear-gradient(135deg, #4cc9f0 0%, #4361ee 100%);
            border-color: #4cc9f0;
            position: relative;
            overflow: hidden;
        }

        .result-popup.netherstar::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            animation: glint 3s infinite linear;
        }

        .result-popup.ender {
            background: linear-gradient(135deg, #7209b7 0%, #3a0ca3 100%);
            border-color: #9d4edd;
            position: relative;
            overflow: hidden;
        }

        .result-popup.ender::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            animation: glint 3s infinite linear;
        }

        .result-popup.masterball {
            background: linear-gradient(135deg, #ff595e 0%, #ff9f1c 100%);
            border-color: #ff9f1c;
        }

        .result-popup.cherish {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            border-color: #ff6b6b;
        }

        .result-popup.golden {
            background: linear-gradient(135deg, #ffd700 0%, #ffb703 100%);
            border-color: #ffd700;
        }

        @keyframes popupAppear {
            from {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }
            to {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        .result-popup h2 {
            color: #98c1d9;
            margin-bottom: 20px;
            font-size: 2em;
        }

        .result-popup.shiny h2,
        .result-popup.netherstar h2,
        .result-popup.ender h2,
        .result-popup.masterball h2,
        .result-popup.cherish h2,
        .result-popup.golden h2 {
            color: white;
        }

        .result-pokemon {
            margin: 20px 0;
        }

        .result-pokemon img {
            width: 120px;
            height: 120px;
            image-rendering: pixelated;
        }

        .result-pokemon-name {
            font-size: 1.5em;
            font-weight: 600;
            margin-top: 10px;
            color: #98c1d9;
        }

        .pokemon-level {
            font-size: 1.1em;
            color: #98c1d9;
            margin-top: 5px;
            font-weight: 600;
        }

        .result-popup.shiny .result-pokemon-name,
        .result-popup.netherstar .result-pokemon-name,
        .result-popup.ender .result-pokemon-name,
        .result-popup.masterball .result-pokemon-name,
        .result-popup.cherish .result-pokemon-name,
        .result-popup.golden .result-pokemon-name {
            color: white;
        }

        .result-shiny-badge {
            display: inline-block;
            background: #000;
            color: #ffd60a;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 700;
            margin-top: 10px;
            animation: shimmer 2s infinite;
        }

        .result-netherstar-badge {
            display: inline-block;
            background: white;
            color: #4361ee;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 700;
            margin-top: 10px;
            animation: shimmer 2s infinite;
        }

        .result-ender-badge {
            display: inline-block;
            background: white;
            color: #7209b7;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 700;
            margin-top: 10px;
            animation: shimmer 2s infinite;
        }

        .result-masterball-badge {
            display: inline-block;
            background: white;
            color: #ff595e;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 700;
            margin-top: 10px;
            animation: shimmer 2s infinite;
        }

        .result-cherish-badge {
            display: inline-block;
            background: white;
            color: #ff6b6b;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 700;
            margin-top: 10px;
            animation: shimmer 2s infinite;
        }

        .result-golden-badge {
            display: inline-block;
            background: #000;
            color: #ffd700;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 700;
            margin-top: 10px;
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .discord-notice {
            background: linear-gradient(135deg, #e63946 0%, #b91d43 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 0.9em;
            font-weight: 600;
            border: 2px solid #ff6b6b;
            box-shadow: 0 0 15px rgba(230, 57, 70, 0.3);
        }

        .close-popup {
            margin-top: 20px;
            padding: 12px 30px;
            background: linear-gradient(135deg, #3d5a80 0%, #5a7a9a 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            font-weight: 600;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 999;
        }

        .overlay.show {
            display: block;
        }

        /* IV Roulette Styles */
        .iv-roulette-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1a1f2e 0%, #2d3748 100%);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.8);
            z-index: 1001;
            min-width: 400px;
            max-width: 500px;
            width: 90%;
            border: 2px solid #4cc9f0;
        }

        .iv-roulette-popup.show {
            display: block;
            animation: popupAppear 0.5s ease;
        }

        .iv-roulette-popup h2 {
            color: #4cc9f0;
            margin-bottom: 20px;
            font-size: 1.8em;
            text-align: center;
        }

        .iv-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-label {
            color: #98c1d9;
            font-weight: 600;
            font-size: 0.95em;
        }

        .form-input {
            padding: 12px;
            border: 2px solid #3d5a80;
            border-radius: 10px;
            font-size: 1em;
            background: #0f1419;
            color: #98c1d9;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #4cc9f0;
            box-shadow: 0 0 10px rgba(76, 201, 240, 0.3);
        }

        .form-select {
            padding: 12px;
            border: 2px solid #3d5a80;
            border-radius: 10px;
            font-size: 1em;
            background: #0f1419;
            color: #98c1d9;
            cursor: pointer;
            transition: all 0.3s;
        }

        .form-select:focus {
            outline: none;
            border-color: #4cc9f0;
            box-shadow: 0 0 10px rgba(76, 201, 240, 0.3);
        }

        .shiny-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            border: 2px solid #3d5a80;
            border-radius: 10px;
            background: #0f1419;
            cursor: pointer;
            transition: all 0.3s;
        }

        .shiny-toggle:hover {
            border-color: #4cc9f0;
        }

        .shiny-toggle.active {
            background: linear-gradient(135deg, rgba(255, 214, 10, 0.2) 0%, rgba(255, 183, 3, 0.2) 100%);
            border-color: #ffd60a;
        }

        .shiny-indicator {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #3d5a80;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .shiny-toggle.active .shiny-indicator {
            background: #ffd60a;
            box-shadow: 0 0 10px rgba(255, 214, 10, 0.5);
        }

        .shiny-indicator::before {
            content: '‚ú®';
            font-size: 12px;
        }

        .iv-info {
            background: rgba(76, 201, 240, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #4cc9f0;
            font-size: 0.9em;
            line-height: 1.5;
            margin-top: 10px;
        }

        .iv-info h4 {
            color: #4cc9f0;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .form-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .submit-iv-button {
            flex: 1;
            padding: 15px;
            background: linear-gradient(135deg, #4cc9f0 0%, #4361ee 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .submit-iv-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(76, 201, 240, 0.4);
        }

        .submit-iv-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .close-iv-button {
            flex: 1;
            padding: 15px;
            background: #2d3748;
            color: #98c1d9;
            border: 2px solid #3d5a80;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .close-iv-button:hover {
            background: #3d5a80;
            color: white;
        }

        .iv-submission-success {
            background: linear-gradient(135deg, rgba(76, 201, 240, 0.2) 0%, rgba(67, 97, 238, 0.2) 100%);
            border: 2px solid #4cc9f0;
            color: #98c1d9;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            margin-top: 15px;
            display: none;
        }

        .iv-submission-success.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .iv-roulette-button {
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: 600;
            background: linear-gradient(135deg, #4cc9f0 0%, #4361ee 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            align-self: center;
            margin-top: 10px;
            width: 100%;
            max-width: 300px;
        }

        .iv-roulette-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(76, 201, 240, 0.4);
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 600px) {
            .pokemon-grid {
                grid-template-columns: 1fr;
            }
            
            .roulette-item {
                flex: 0 0 100px;
                height: 140px;
            }
            
            .roulette-item img {
                width: 48px;
                height: 48px;
            }
            
            .wheel-type-selector {
                flex-direction: column;
            }
            
            .result-popup {
                min-width: 300px;
                padding: 20px;
            }
            
            .iv-roulette-popup {
                min-width: 300px;
                padding: 20px;
            }
            
            .form-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Cobblemon Lucky Wheel</h1>
            <p>Trade for a Token and spin! ‚Ä¢ Submit Pok√©mon for IV Roulette!</p>
        </div>

        <div class="main-content">
            <div class="wheel-section">
                <div class="wheel-type-selector">
                    <button class="wheel-type-btn" onclick="switchWheel('hourly')">Hourly Spin</button>
                    <button class="wheel-type-btn active" onclick="switchWheel('normal')">Normal Legendaries</button>
                    <button class="wheel-type-btn" onclick="switchWheel('event')">Event Legendaries</button>
                    <button class="wheel-type-btn" onclick="switchWheel('special')">Special</button>
                </div>

                <div class="shiny-info" id="shinyInfo">‚ú® 1% chance for SHINY! ‚ú®</div>

                <div class="roulette-container">
                    <div class="roulette-wrapper">
                        <div class="roulette-selector"></div>
                        <div class="roulette-track" id="rouletteTrack"></div>
                    </div>
                </div>

                <button class="spin-button" id="spinButton" onclick="spin()">Spin the Wheel!</button>
                
                <!-- New IV Roulette Button -->
                <button class="iv-roulette-button" onclick="openIVRoulette()">üé≤ IV Roulette üé≤</button>
            </div>

            <div class="sidebar">
                <div class="token-display" id="tokenDisplay">
                    <h3>Your Legendary Tokens</h3>
                    
                    <!-- Login Form (shown when not logged in) -->
                    <div class="login-form" id="loginForm">
                        <input type="text" class="login-input" id="usernameInput" placeholder="Username" autocomplete="username">
                        <input type="password" class="login-input" id="passwordInput" placeholder="Password" autocomplete="current-password">
                        <div class="login-error" id="loginError">Invalid username or password!</div>
                        <button class="login-button" onclick="login()">Login</button>
                    </div>
                    
                    <!-- Logged in view -->
                    <div id="loggedInView" style="display: none;">
                        <div class="player-info">
                            <div class="player-name" id="playerNameDisplay">-</div>
                            <div class="player-subtitle">Logged In</div>
                        </div>
                        
                        <div class="token-count" id="normalTokenCount">-</div>
                        <div style="font-size: 0.9em; opacity: 0.9;">Normal Tokens</div>
                        <div class="token-count" id="eventTokenCount" style="font-size: 2em; margin-top: 15px;">-</div>
                        <div style="font-size: 0.9em; opacity: 0.9;">Event Tokens</div>
                        <div class="token-count" id="specialTokenCount" style="font-size: 2em; margin-top: 15px; color: #ffd60a;">-</div>
                        <div style="font-size: 0.9em; opacity: 0.9;">Special Tokens</div>
                        
                        <button class="logout-button" onclick="logout()">Logout</button>
                        <button class="refresh-button" onclick="loadTokenData()">üîÑ Refresh Tokens</button>
                        
                        <div class="trade-info">
                            <h4>üíé How to Get Tokens:</h4>
                            <p><strong>Normal Token:</strong> Trade 5 Shinies (any kind)</p>
                            <p><strong>Event Token:</strong> Trade 1x Masterball</p>
                            <p><strong>Special Token:</strong> Release 10x Legendaries (Shinys count as 3)</p>
                        </div>
                    </div>
                </div>

                <div class="pokemon-list">
                    <h3 id="listTitle">Available Normal Legendaries</h3>
                    <div class="pokemon-grid" id="pokemonList"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="overlay" id="overlay"></div>
    
    <!-- Result Popup for Wheel Spins -->
    <div class="result-popup" id="resultPopup">
        <h2 id="resultTitle">Congratulations! üéâ</h2>
        <div class="discord-notice">
            ‚ö†Ô∏è IMPORTANT: Send a screenshot of this win to the Discord to claim your prize!
        </div>
        <div class="result-pokemon">
            <img id="resultSprite" src="" alt="Prize">
            <div class="result-pokemon-name" id="resultName"></div>
            <div class="pokemon-level" id="resultLevel"></div>
            <div id="shinyBadge" style="display: none;" class="result-shiny-badge">‚ú® SHINY ‚ú®</div>
            <div id="netherstarBadge" style="display: none;" class="result-netherstar-badge">üåü NETHER STAR üåü</div>
            <div id="enderBadge" style="display: none;" class="result-ender-badge">üëÅÔ∏è EYES OF ENDER üëÅÔ∏è</div>
            <div id="masterballBadge" style="display: none;" class="result-masterball-badge">üéæ MASTERBALL üéæ</div>
            <div id="cherishBadge" style="display: none;" class="result-cherish-badge">‚ù§Ô∏è CHERISH BALL ‚ù§Ô∏è</div>
            <div id="goldenBadge" style="display: none;" class="result-golden-badge">üåü GOLDEN GMAX üåü</div>
        </div>
        <button class="close-popup" onclick="closePopup()">Close</button>
    </div>
    
    <!-- IV Roulette Popup -->
    <div class="iv-roulette-popup" id="ivRoulettePopup">
        <h2>üé≤ IV Roulette Submission üé≤</h2>
        <p style="color: #98c1d9; text-align: center; margin-bottom: 20px; font-size: 0.95em;">
            Submit your Pok√©mon to have its IVs perfected! Winners selected daily via Discord livestream.
        </p>
        
        <div class="iv-form" id="ivForm">
            <div class="form-group">
                <label class="form-label" for="pokemonSpecies">Pok√©mon Species *</label>
                <input type="text" class="form-input" id="pokemonSpecies" placeholder="e.g., Charizard, Pikachu" required>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="pokemonNickname">Nickname (if any)</label>
                <input type="text" class="form-input" id="pokemonNickname" placeholder="Optional nickname">
            </div>
            
            <div class="form-group">
                <label class="form-label" for="pokemonLevel">Current Level *</label>
                <input type="number" class="form-input" id="pokemonLevel" placeholder="e.g., 50" min="1" max="100" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Is it Shiny? *</label>
                <div class="shiny-toggle" id="shinyToggle" onclick="toggleShiny()">
                    <span style="color: #98c1d9;">Shiny Status</span>
                    <div class="shiny-indicator"></div>
                </div>
            </div>
            
            <div class="iv-info">
                <h4>üìã How it works:</h4>
                <p>‚Ä¢ Submit your Pok√©mon to have its IVs perfected to 31 in all stats</p>
                <p>‚Ä¢ Submissions are cleared daily</p>
                <p>‚Ä¢ Winners selected every evening via Discord livestream</p>
                <p>‚Ä¢ You must be logged in to submit</p>
            </div>
            
            <div class="iv-submission-success" id="ivSubmissionSuccess">
                ‚úÖ Submission successful! Check Discord for the daily livestream.
            </div>
            
            <div class="form-buttons">
                <button class="submit-iv-button" id="submitIVButton" onclick="submitIVRoulette()">Submit for IV Roulette</button>
                <button class="close-iv-button" onclick="closeIVRoulette()">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Discord Webhook URLs
        const DISCORD_WEBHOOK_URL = 'https://discord.com/api/webhooks/1463207027861094585/Fc8lWs42Z6VO3IE0j3iFqzGARohCidnKihDAWU33bqt42rfggEFHJmlJ9NEvjM-7DsSp';
        const DISCORD_IV_WEBHOOK_URL = 'https://discord.com/api/webhooks/1463926867185631245/22CqHhqbdfmIEVnFUXZgCXn2Bi6ut5o9MPCiUBS3caKC4w3IMm2a3hrbcqx3ov5jcFtK';

        // Hourly Spin Items (with proper Pok√©ball sprites and new token pulls)
        const hourlyItems = [
            { name: 'Nether Star', id: 'nether_star', count: 1, type: 'netherstar', rarity: 'legendary', isMinecraft: true },
            { name: 'Eyes of Ender', id: 'ender_eye', count: 8, type: 'ender', rarity: 'rare', isMinecraft: true },
            { name: 'Masterball', id: 'masterball', count: 1, type: 'masterball', rarity: 'legendary', sprite: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/master-ball.png' },
            { name: 'Cherish Ball', id: 'cherish_ball', count: 8, type: 'cherish', rarity: 'rare', sprite: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/cherish-ball.png' },
            { name: 'Diamond', id: 'diamond', count: 10, type: 'rare', isMinecraft: true },
            { name: 'Netherite Scrap', id: 'netherite_scrap', count: 3, type: 'rare', isMinecraft: true },
            { name: 'Ultra Ball', id: 'ultra_ball', count: 64, type: 'pokeball', rarity: 'uncommon', sprite: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/ultra-ball.png' },
            { name: 'Great Ball', id: 'great_ball', count: 32, type: 'pokeball', rarity: 'uncommon', sprite: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/great-ball.png' },
            { name: 'Quick Ball', id: 'quick_ball', count: 32, type: 'pokeball', rarity: 'uncommon', sprite: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/quick-ball.png' },
            // New token pulls
            { name: '+1 Event Pull', id: 'event_token_1', count: 1, type: 'token', rarity: 'rare', isToken: true, tokenType: 'event', tokenAmount: 1 },
            { name: '+5 Event Pulls', id: 'event_token_5', count: 5, type: 'token', rarity: 'legendary', isToken: true, tokenType: 'event', tokenAmount: 5 },
            { name: '+1 Special Pull', id: 'special_token_1', count: 1, type: 'token', rarity: 'rare', isToken: true, tokenType: 'special', tokenAmount: 1 },
            { name: '+3 Special Pulls', id: 'special_token_3', count: 3, type: 'token', rarity: 'legendary', isToken: true, tokenType: 'special', tokenAmount: 3 }
        ];

        // Pokemon lists
        const normalLegendaries = [
            { name: 'Articuno', id: 144, shiny: false },
            { name: 'Zapdos', id: 145, shiny: false },
            { name: 'Moltres', id: 146, shiny: false },
            { name: 'Entei', id: 244, shiny: false },
            { name: 'Raikou', id: 243, shiny: false },
            { name: 'Suicune', id: 245, shiny: false },
            { name: 'Celebi', id: 251, shiny: false },
            { name: 'Regirock', id: 377, shiny: false },
            { name: 'Regice', id: 378, shiny: false },
            { name: 'Registeel', id: 379, shiny: false },
            { name: 'Jirachi', id: 385, shiny: false },
            { name: 'Regigigas', id: 486, shiny: false },
            { name: 'Victini', id: 494, shiny: false },
            { name: 'Zarude', id: 893, shiny: false },
            { name: 'Regieleki', id: 894, shiny: false },
            { name: 'Regidrago', id: 895, shiny: false },
            { name: 'Roaring Moon', id: 1005, shiny: false, rarity: 'legendary' },
            { name: 'Walking Wake', id: 1009, shiny: false, rarity: 'legendary' },
            { name: 'Iron Leaves', id: 1010, shiny: false, rarity: 'legendary' },
            { name: 'Archaludon', id: 1018, shiny: false, rarity: 'legendary' },
            // Shiny only Pokemon (more common)
            { name: 'Umbreon', id: 197, shiny: true, rarity: 'common' },
            { name: 'Espeon', id: 196, shiny: true, rarity: 'common' },
            { name: 'Milotic', id: 350, shiny: true, rarity: 'common' },
            { name: 'Metagross', id: 376, shiny: true, rarity: 'common' },
            { name: 'Mismagius', id: 429, shiny: true, rarity: 'common' },
            { name: 'Gliscor', id: 472, shiny: true, rarity: 'common' },
            { name: 'Gigalith', id: 526, shiny: true, rarity: 'common' },
            { name: 'Gardevoir', id: 282, shiny: true, rarity: 'common' },
            { name: 'Luxray', id: 405, shiny: true, rarity: 'common' },
            { name: 'Gallade', id: 475, shiny: true, rarity: 'common' },
            { name: 'Togekiss', id: 468, shiny: true, rarity: 'common' },
            { name: 'Noivern', id: 715, shiny: true, rarity: 'common' },
            { name: 'Sneasler', id: 903, shiny: true, rarity: 'common' },
            { name: 'Necrozma', id: 800, shiny: true, rarity: 'legendary' },
            { name: 'Kartana', id: 798, shiny: true, rarity: 'legendary' }
        ];

        const eventLegendaries = [
            { name: 'Mew', id: 151, shiny: false },
            { name: 'Mewtwo', id: 150, shiny: false },
            { name: 'Lugia', id: 249, shiny: false },
            { name: 'Ho-Oh', id: 250, shiny: false },
            { name: 'Deoxys', id: 386, shiny: false },
            { name: 'Rayquaza', id: 384, shiny: false },
            { name: 'Latias', id: 380, shiny: false },
            { name: 'Latios', id: 381, shiny: false },
            { name: 'Kyogre', id: 382, shiny: false },
            { name: 'Groudon', id: 383, shiny: false },
            { name: 'Dialga', id: 483, shiny: false },
            { name: 'Palkia', id: 484, shiny: false },
            { name: 'Giratina', id: 487, shiny: false },
            { name: 'Darkrai', id: 491, shiny: false },
            // Arceus removed from event wheel as requested
            { name: 'Reshiram', id: 643, shiny: false },
            { name: 'Zekrom', id: 644, shiny: false },
            { name: 'Kyurem', id: 646, shiny: false },
            { name: 'Xerneas', id: 716, shiny: false },
            { name: 'Solgaleo', id: 791, shiny: false },
            { name: 'Lunala', id: 792, shiny: false },
            { name: 'Zacian', id: 888, shiny: false },
            { name: 'Zamazenta', id: 889, shiny: false },
            { name: 'Koraidon', id: 1007, shiny: false },
            { name: 'Miraidon', id: 1008, shiny: false },
            // New event legendaries with correct spawn names
            { name: 'Tapu Koko', id: 785, shiny: false, spawnName: 'tapukoko' },
            { name: 'Tapu Lele', id: 786, shiny: false, spawnName: 'tapulele' },
            { name: 'Tapu Bulu', id: 787, shiny: false, spawnName: 'tapubulu' },
            { name: 'Tapu Fini', id: 788, shiny: false, spawnName: 'tapufini' },
            { name: 'Tornadus', id: 641, shiny: false, spawnName: 'tornadus' },
            { name: 'Thundurus', id: 642, shiny: false, spawnName: 'thundurus' },
            { name: 'Landorus', id: 645, shiny: false, spawnName: 'landorus' },
            // New shiny-only event additions (Eternatus last in this section)
            { name: 'Spiritomb', id: 442, shiny: true, rarity: 'legendary' },
            { name: 'Lucario', id: 448, shiny: true, rarity: 'legendary' },
            { name: 'Zoroark', id: 571, shiny: true, rarity: 'legendary' },
            { name: 'Haxorus', id: 612, shiny: true, rarity: 'legendary' },
            { name: 'Sylveon', id: 700, shiny: true, rarity: 'legendary' },
            { name: 'Naganadel', id: 804, shiny: true, rarity: 'legendary' },
            { name: 'Dragapult', id: 887, shiny: true, rarity: 'legendary' },
            { name: 'Eternatus', id: 890, shiny: true, rarity: 'legendary', level: 85 }
        ];

        // Additional Pokemon for hourly spin (all shiny)
        const hourlyPokemon = [
            { name: 'Growlithe', id: 58, shiny: true, rarity: 'uncommon' },
            { name: 'Machop', id: 66, shiny: true, rarity: 'uncommon' },
            { name: 'Dratini', id: 147, shiny: true, rarity: 'uncommon' },
            { name: 'Ralts', id: 280, shiny: true, rarity: 'uncommon' },
            // New shiny starter additions (rarer than common drops)
            { name: 'Bulbasaur', id: 1, shiny: true, rarity: 'rare' },
            { name: 'Charmander', id: 4, shiny: true, rarity: 'rare' },
            { name: 'Squirtle', id: 7, shiny: true, rarity: 'rare' },
            { name: 'Treecko', id: 252, shiny: true, rarity: 'rare' },
            { name: 'Torchic', id: 255, shiny: true, rarity: 'rare' },
            { name: 'Mudkip', id: 258, shiny: true, rarity: 'rare' },
            { name: 'Charcadet', id: 935, shiny: true, rarity: 'rare' }
        ];

        // Special wheel items (releasing 10x legendaries, shinys count as 3)
        const specialItems = [
            // Common items
            { name: 'Masterball', id: 'masterball', count: 3, type: 'masterball', rarity: 'common', sprite: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/master-ball.png' },
            { name: 'Netherite Ingot', id: 'netherite_ingot', count: 10, type: 'rare', rarity: 'common', isMinecraft: true },
            { name: 'Nether Star', id: 'nether_star', count: 5, type: 'netherstar', rarity: 'common', isMinecraft: true },
            
            // Ultra rare Pokemon with special forms (possible shiny)
            { name: 'Armored Shadow Mewtwo', id: 150, shiny: true, rarity: 'ultra_rare', spawnName: 'mewtwo shadows armored', level: 100, special: true },
            { name: 'Chien-Pao', id: 1002, shiny: false, rarity: 'ultra_rare', spawnName: 'chienpao', level: 100, special: true },
            { name: 'Terapagos', id: 1024, shiny: false, rarity: 'ultra_rare', spawnName: 'terapagos', level: 100, special: true },
            { name: 'Cosmoem', id: 790, shiny: false, rarity: 'ultra_rare', spawnName: 'cosmoem', level: 100, special: true },
            { name: 'Genesect', id: 649, shiny: false, rarity: 'ultra_rare', spawnName: 'genesect', level: 100, special: true },
            { name: 'Urshifu', id: 892, shiny: false, rarity: 'ultra_rare', spawnName: 'urshifu', level: 100, special: true },
            
            // Golden GMAX Pokemon (all shiny with golden shine)
            { name: 'GMAX Charizard', id: 6, shiny: true, rarity: 'golden', spawnName: 'charizard dynamax_form=gmax', level: 100, special: true, golden: true },
            { name: 'GMAX Venusaur', id: 3, shiny: true, rarity: 'golden', spawnName: 'venusaur dynamax_form=gmax', level: 100, special: true, golden: true },
            { name: 'GMAX Blastoise', id: 9, shiny: true, rarity: 'golden', spawnName: 'blastoise dynamax_form=gmax', level: 100, special: true, golden: true },
            { name: 'GMAX Machamp', id: 68, shiny: true, rarity: 'golden', spawnName: 'machamp dynamax_form=gmax', level: 100, special: true, golden: true },
            { name: 'GMAX Gengar', id: 94, shiny: true, rarity: 'golden', spawnName: 'gengar dynamax_form=gmax', level: 100, special: true, golden: true },
            { name: 'GMAX Cinderace', id: 815, shiny: true, rarity: 'golden', spawnName: 'cinderace dynamax_form=gmax', level: 100, special: true, golden: true },
            { name: 'GMAX Rillaboom', id: 812, shiny: true, rarity: 'golden', spawnName: 'rillaboom dynamax_form=gmax', level: 100, special: true, golden: true },
            { name: 'GMAX Corviknight', id: 823, shiny: true, rarity: 'golden', spawnName: 'corviknight dynamax_form=gmax', level: 100, special: true, golden: true },
            { name: 'GMAX Toxtricity', id: 849, shiny: true, rarity: 'golden', spawnName: 'toxtricity dynamax_form=gmax', level: 100, special: true, golden: true },
            { name: 'GMAX Urshifu', id: 892, shiny: true, rarity: 'golden', spawnName: 'urshifu dynamax_form=gmax', level: 100, special: true, golden: true },
            
            // Updated Necrozma forms (now always shiny)
            { name: 'Necrozma (Dawn)', id: 800, shiny: true, rarity: 'ultra_rare', form: 'necrozma prism_fusion=dawn', level: 100, special: true }, // Always shiny
            { name: 'Necrozma (Dusk)', id: 800, shiny: true, rarity: 'ultra_rare', form: 'necrozma prism_fusion=dusk', level: 100, special: true }, // Always shiny
            
            // New additions
            { name: 'Gholdengo (Netherite)', id: 1000, shiny: false, rarity: 'ultra_rare', form: 'gholdengo netherite_coating=full', level: 100, special: true },
            { name: 'Marshadow', id: 802, shiny: true, rarity: 'ultra_rare', form: 'marshadow shiny', level: 100, special: true }, // Always shiny
            { name: 'Ogerpon (Perfect IV)', id: 1017, shiny: false, rarity: 'ultra_rare', form: 'ogerpon hp_iv=31 attack_iv=31 defence_iv=31 special_attack_iv=31 special_defence_iv=31 speed_iv=31', level: 100, special: true },
            
            { name: 'Kingambit', id: 983, shiny: false, rarity: 'ultra_rare', form: 'kingambit', level: 100, special: true },
            { name: 'Hoopa (Unbound)', id: 720, shiny: false, rarity: 'ultra_rare', form: 'hoopa', level: 100, special: true, extraItem: 'totem_of_undying' },
            { name: 'White Kyurem', id: 646, shiny: false, rarity: 'ultra_rare', form: 'kyurem absofusion=white', level: 100, special: true },
            { name: 'Black Kyurem', id: 646, shiny: false, rarity: 'ultra_rare', form: 'kyurem absofusion=black', level: 100, special: true },
            { name: 'Arceus', id: 493, shiny: false, rarity: 'ultra_rare', form: 'arceus', level: 100, special: true },
            { name: 'Red\'s Charizard', id: 6, shiny: false, rarity: 'ultra_rare', form: 'charizard', level: 100, special: true }
        ];

        let currentWheel = 'normal';
        let spinning = false;
        let tokenData = {};
        let userAccounts = {}; // Stores username:password pairs
        let selectedPlayer = '';
        let isShinyIV = false; // For IV Roulette
        
        const SHINY_CHANCE = 0.01;
        const SHINY_ONLY_CHANCE = 0.10; // 10% chance for shiny-only Pokemon in normal wheel
        const MASTERBALL_CHANCE = 0.01; // Same as Nether Star rarity
        const RARE_SHINY_CHANCE = 0.03; // 3% chance for rare shiny starters in hourly
        const SPECIAL_SHINY_CHANCE = 0.05; // 5% chance for shiny in special wheel
        const TOKEN_PULL_CHANCE = 0.05; // 5% chance for token pulls in hourly
        let rouletteItems = [];

        // Function to open IV Roulette popup
        function openIVRoulette() {
            if (!selectedPlayer) {
                alert('Please login first to submit Pok√©mon for IV Roulette!');
                return;
            }
            
            document.getElementById('ivRoulettePopup').classList.add('show');
            document.getElementById('overlay').classList.add('show');
        }

        // Function to close IV Roulette popup
        function closeIVRoulette() {
            document.getElementById('ivRoulettePopup').classList.remove('show');
            document.getElementById('overlay').classList.remove('show');
            resetIVForm();
        }

        // Function to toggle shiny status in IV form
        function toggleShiny() {
            const toggle = document.getElementById('shinyToggle');
            isShinyIV = !isShinyIV;
            toggle.classList.toggle('active', isShinyIV);
        }

        // Function to reset IV form
        function resetIVForm() {
            document.getElementById('pokemonSpecies').value = '';
            document.getElementById('pokemonNickname').value = '';
            document.getElementById('pokemonLevel').value = '';
            isShinyIV = false;
            document.getElementById('shinyToggle').classList.remove('active');
            document.getElementById('ivSubmissionSuccess').classList.remove('show');
        }

        // Function to submit IV Roulette
        async function submitIVRoulette() {
            const species = document.getElementById('pokemonSpecies').value.trim();
            const nickname = document.getElementById('pokemonNickname').value.trim();
            const level = document.getElementById('pokemonLevel').value.trim();
            
            // Validate inputs
            if (!species || !level) {
                alert('Please fill in all required fields (Species and Level)!');
                return;
            }
            
            const levelNum = parseInt(level);
            if (isNaN(levelNum) || levelNum < 1 || levelNum > 100) {
                alert('Please enter a valid level between 1 and 100!');
                return;
            }
            
            // Disable button to prevent double submission
            const submitButton = document.getElementById('submitIVButton');
            submitButton.disabled = true;
            submitButton.textContent = 'Submitting...';
            
            try {
                // Send to Discord webhook
                await sendIVToDiscordWebhook(species, nickname, levelNum, isShinyIV);
                
                // Show success message
                const successMessage = document.getElementById('ivSubmissionSuccess');
                successMessage.classList.add('show');
                
                // Reset form after delay
                setTimeout(() => {
                    closeIVRoulette();
                }, 2000);
                
            } catch (error) {
                console.error('Error submitting IV Roulette:', error);
                alert('Failed to submit. Please try again!');
                submitButton.disabled = false;
                submitButton.textContent = 'Submit for IV Roulette';
            }
        }

        // Function to send IV Roulette submission to Discord webhook
        async function sendIVToDiscordWebhook(species, nickname, level, isShiny) {
            const inGameName = getInGamePlayerName(selectedPlayer);
            
            // Format the message
            let messageContent = `üé≤ **NEW IV ROULETTE SUBMISSION!** üé≤\n`;
            messageContent += `**Player (Website):** ${selectedPlayer}\n`;
            messageContent += `**Player (In-Game):** ${inGameName}\n`;
            messageContent += `**Pok√©mon Species:** ${species}\n`;
            
            if (nickname) {
                messageContent += `**Nickname:** ${nickname}\n`;
            }
            
            messageContent += `**Current Level:** ${level}\n`;
            messageContent += `**Shiny:** ${isShiny ? 'Yes ‚ú®' : 'No'}\n`;
            messageContent += `**Prize:** IVs perfected to 31 in all stats\n`;
            messageContent += `\n**Submission Time:** ${new Date().toLocaleString()}`;
            messageContent += `\n\n*Submissions cleared daily. Winners selected via Discord livestream.*`;

            // Create the webhook payload
            const payload = {
                username: "Cobblemon IV Roulette Bot",
                avatar_url: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/493.png", // Arceus sprite
                content: messageContent,
                embeds: [
                    {
                        title: "üé≤ IV Roulette Entry",
                        color: isShiny ? 0xFFD700 : 0x4CC9F0,
                        timestamp: new Date().toISOString(),
                        footer: {
                            text: "Cobblemon IV Roulette System - Daily Draw"
                        },
                        fields: [
                            {
                                name: "Player",
                                value: `${selectedPlayer} (${inGameName})`,
                                inline: true
                            },
                            {
                                name: "Level",
                                value: level.toString(),
                                inline: true
                            },
                            {
                                name: "Shiny",
                                value: isShiny ? "‚ú® Yes" : "No",
                                inline: true
                            }
                        ]
                    }
                ]
            };

            // Send to Discord webhook
            const response = await fetch(DISCORD_IV_WEBHOOK_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(`Discord webhook error: ${response.status}`);
            }
        }

        // Function to get in-game player name (mapping website name to in-game name)
        function getInGamePlayerName(websiteName) {
            // Special case mapping
            if (websiteName.toLowerCase() === 'nensparkling') {
                return 'athaice';
            }
            // Add more mappings here if needed
            return websiteName;
        }

        // Function to generate command for prize
        function generateCommand(username, winDetails, wheelType) {
            const inGameName = getInGamePlayerName(username);
            let command = '';
            
            if (wheelType === 'hourly') {
                if (winDetails.isPokemon) {
                    // Pokemon command
                    command = `/execute as ${inGameName} at @s run pokespawn ${winDetails.pokemon.toLowerCase()} lvl=1 shiny`;
                } else if (winDetails.isToken) {
                    // Token pull - no in-game command, just notification for manual addition
                    command = `[TOKEN PULL - MANUAL ADDITION NEEDED]\nPlayer: ${inGameName}\nToken Type: ${winDetails.tokenType}\nAmount: ${winDetails.tokenAmount}`;
                } else {
                    // Minecraft item command
                    if (winDetails.type === 'masterball' || winDetails.type === 'cherish') {
                        // Pok√©ball items
                        command = `/give ${inGameName} cobblemon:${winDetails.id} ${winDetails.count}`;
                    } else {
                        // Normal Minecraft items
                        command = `/give ${inGameName} minecraft:${winDetails.id} ${winDetails.count}`;
                    }
                }
            } else if (wheelType === 'special') {
                if (winDetails.isPokemon) {
                    // Special form Pokemon
                    if (winDetails.spawnName) {
                        command = `/execute as ${inGameName} at @s run pokespawn ${winDetails.spawnName} lvl=${winDetails.level}${winDetails.isShiny ? ' shiny' : ''}`;
                    } else if (winDetails.specialForm) {
                        command = `/execute as ${inGameName} at @s run pokespawn ${winDetails.specialForm} lvl=${winDetails.level}${winDetails.isShiny ? ' shiny' : ''}`;
                    } else {
                        command = `/execute as ${inGameName} at @s run pokespawn ${winDetails.pokemon.toLowerCase()} lvl=${winDetails.level}${winDetails.isShiny ? ' shiny' : ''}`;
                    }
                    
                    // Add extra command for Hoopa's totem
                    if (winDetails.pokemon === 'Hoopa (Unbound)') {
                        command += `\n/give ${inGameName} minecraft:totem_of_undying 1`;
                    }
                } else {
                    // Minecraft items in special wheel
                    if (winDetails.type === 'masterball') {
                        command = `/give ${inGameName} cobblemon:${winDetails.id} ${winDetails.count}`;
                    } else {
                        command = `/give ${inGameName} minecraft:${winDetails.id} ${winDetails.count}`;
                    }
                }
            } else {
                // Normal or Event legendary wheel
                const spawnName = winDetails.spawnName || winDetails.pokemon.toLowerCase();
                if (winDetails.pokemon === 'Eternatus') {
                    // Special level for Eternatus
                    command = `/execute as ${inGameName} at @s run pokespawn ${spawnName} lvl=${winDetails.level}${winDetails.shiny ? ' shiny' : ''}`;
                } else {
                    command = `/execute as ${inGameName} at @s run pokespawn ${spawnName} lvl=${winDetails.level}${winDetails.shiny ? ' shiny' : ''}`;
                }
            }
            
            return command;
        }

        // Function to send win to Discord webhook
        async function sendToDiscordWebhook(username, winDetails, wheelType) {
            try {
                // Get in-game name and command
                const inGameName = getInGamePlayerName(username);
                const command = generateCommand(username, winDetails, wheelType);
                
                // Format the message based on wheel type and win type
                let messageContent = `üéâ **NEW WHEEL WIN!** üéâ\n`;
                messageContent += `**Player (Website):** ${username}\n`;
                messageContent += `**Player (In-Game):** ${inGameName}\n`;
                messageContent += `**Wheel Type:** ${wheelType.charAt(0).toUpperCase() + wheelType.slice(1)}\n`;
                
                if (wheelType === 'hourly') {
                    if (winDetails.isPokemon) {
                        messageContent += `**Prize:** ‚ú® Shiny ${winDetails.pokemon} (Lvl 1)\n`;
                    } else if (winDetails.isToken) {
                        messageContent += `**Prize:** +${winDetails.tokenAmount} ${winDetails.tokenType.toUpperCase()} Pull${winDetails.tokenAmount > 1 ? 's' : ''}\n`;
                        messageContent += `**Special:** ‚ö†Ô∏è MANUAL TOKEN ADDITION REQUIRED ‚ö†Ô∏è\n`;
                    } else {
                        messageContent += `**Prize:** ${winDetails.item} (${winDetails.count}x)\n`;
                        if (winDetails.type === 'netherstar') {
                            messageContent += `**Rarity:** üåü Nether Star (Ultimate Prize!)\n`;
                        } else if (winDetails.type === 'ender') {
                            messageContent += `**Rarity:** üëÅÔ∏è Eyes of Ender (Rare!)\n`;
                        } else if (winDetails.type === 'masterball') {
                            messageContent += `**Rarity:** üéæ Masterball (Legendary!)\n`;
                        } else if (winDetails.type === 'cherish') {
                            messageContent += `**Rarity:** ‚ù§Ô∏è Cherish Balls (Rare!)\n`;
                        }
                    }
                } else if (wheelType === 'special') {
                    if (winDetails.isPokemon) {
                        messageContent += `**Pok√©mon:** ${winDetails.pokemon}${winDetails.isShiny ? ' ‚ú®' : ''}\n`;
                        messageContent += `**Level:** ${winDetails.level}\n`;
                        messageContent += `**Shiny:** ${winDetails.isShiny ? 'Yes' : 'No'}\n`;
                        messageContent += `**Spawn Name:** ${winDetails.spawnName || winDetails.pokemon.toLowerCase()}\n`;
                        
                        if (winDetails.pokemon === 'Hoopa (Unbound)') {
                            messageContent += `**Extra Prize:** Totem of Undying\n`;
                        }
                        
                        if (winDetails.golden) {
                            messageContent += `**Special:** üåü GOLDEN GMAX üåü\n`;
                        }
                    } else {
                        messageContent += `**Prize:** ${winDetails.item} (${winDetails.count}x)\n`;
                    }
                    messageContent += `**Rarity:** ${winDetails.rarity === 'ultra_rare' ? 'üåü ULTRA RARE üåü' : (winDetails.rarity === 'golden' ? 'üåü GOLDEN GMAX üåü' : 'Common')}\n`;
                } else {
                    // Legendary wheel win
                    messageContent += `**Pok√©mon:** ${winDetails.pokemon}${winDetails.shiny ? ' ‚ú®' : ''}\n`;
                    messageContent += `**Level:** ${winDetails.level}\n`;
                    messageContent += `**Shiny:** ${winDetails.shiny ? 'Yes' : 'No'}\n`;
                    messageContent += `**Spawn Name:** ${winDetails.spawnName || winDetails.pokemon.toLowerCase()}\n`;
                    
                    if (winDetails.pokemon === 'Eternatus') {
                        messageContent += `**Special:** üåü ULTIMATE PRIZE! üåü\n`;
                    }
                }
                
                messageContent += `\n**üéÆ GIVE COMMAND:**\n\`\`\`\n${command}\n\`\`\``;
                messageContent += `\n**Time:** ${new Date().toLocaleString()}`;

                // Create the webhook payload
                const payload = {
                    username: "Cobblemon Wheel Bot",
                    avatar_url: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/25.png",
                    content: messageContent,
                    embeds: [
                        {
                            title: "üé° Lucky Wheel Result",
                            color: winDetails.shiny || winDetails.isShiny || winDetails.isPokemon ? 0xFFD700 : (winDetails.golden ? 0xFFD700 : 0x5865F2),
                            timestamp: new Date().toISOString(),
                            footer: {
                                text: "Cobblemon Lucky Wheel System"
                            }
                        }
                    ]
                };

                // Send to Discord webhook
                const response = await fetch(DISCORD_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    console.error('Failed to send to Discord webhook:', response.status);
                }
            } catch (error) {
                console.error('Error sending to Discord webhook:', error);
                // Don't alert the user - just log it silently
            }
        }

        // Load saved login from localStorage
        function loadSavedLogin() {
            const savedUser = localStorage.getItem('wheel_logged_in_user');
            if (savedUser) {
                selectedPlayer = savedUser;
                updateLoginUI();
                loadTokenData();
            }
        }

        // Update login UI based on login state
        function updateLoginUI() {
            const loginForm = document.getElementById('loginForm');
            const loggedInView = document.getElementById('loggedInView');
            const playerNameDisplay = document.getElementById('playerNameDisplay');
            const usernameInput = document.getElementById('usernameInput');
            const passwordInput = document.getElementById('passwordInput');
            const loginError = document.getElementById('loginError');
            
            if (selectedPlayer) {
                // User is logged in
                loginForm.style.display = 'none';
                loggedInView.style.display = 'block';
                playerNameDisplay.textContent = selectedPlayer;
                
                // Clear password field
                passwordInput.value = '';
                loginError.style.display = 'none';
            } else {
                // User is not logged in
                loginForm.style.display = 'flex';
                loggedInView.style.display = 'none';
                playerNameDisplay.textContent = '-';
                
                // Clear input fields
                usernameInput.value = '';
                passwordInput.value = '';
                loginError.style.display = 'none';
                
                // Reset token display
                document.getElementById('normalTokenCount').textContent = '-';
                document.getElementById('eventTokenCount').textContent = '-';
                document.getElementById('specialTokenCount').textContent = '-';
            }
        }

        // Login function
        function login() {
            const username = document.getElementById('usernameInput').value.trim();
            const password = document.getElementById('passwordInput').value.trim();
            const loginError = document.getElementById('loginError');
            
            if (!username || !password) {
                loginError.textContent = 'Please enter username and password!';
                loginError.style.display = 'block';
                return;
            }
            
            // Check if username exists and password matches
            if (userAccounts[username] && userAccounts[username] === password) {
                selectedPlayer = username;
                localStorage.setItem('wheel_logged_in_user', username);
                updateLoginUI();
                loadTokenData();
                loginError.style.display = 'none';
            } else {
                loginError.textContent = 'Invalid username or password!';
                loginError.style.display = 'block';
            }
        }

        // Logout function
        function logout() {
            selectedPlayer = '';
            localStorage.removeItem('wheel_logged_in_user');
            updateLoginUI();
            tokenData = {};
        }

        // Get Minecraft item sprite
        function getMinecraftSprite(id) {
            return `https://minecraftitemids.com/item/64/${id}.png`;
        }

        // Get Pokemon sprite
        function getSprite(id, shiny = false) {
            if (shiny) {
                return `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/shiny/${id}.png`;
            }
            return `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${id}.png`;
        }

        // Get Pokemon level based on wheel type and shiny status
        function getPokemonLevel(wheelType, isShiny = false) {
            switch(wheelType) {
                case 'hourly':
                    return 1;
                case 'normal':
                    return isShiny ? 45 : 50;
                case 'event':
                    // Special case for Eternatus - level 85
                    return 70;
                case 'special':
                    return 100;
                default:
                    return 50;
            }
        }

        // Load spins history from localStorage
        function loadSpinsHistory() {
            const history = localStorage.getItem('wheel_spins_history');
            return history ? JSON.parse(history) : {};
        }

        // Save spins history to localStorage
        function saveSpinsHistory(history) {
            localStorage.setItem('wheel_spins_history', JSON.stringify(history));
        }

        // Get remaining spins for player
        function getRemainingSpins(player, tokenType) {
            const history = loadSpinsHistory();
            let playerKey;
            
            if (tokenType === 'event') {
                playerKey = player + '_event';
            } else if (tokenType === 'special') {
                playerKey = player + '_special';
            } else {
                playerKey = player;
            }
            
            const usedSpins = history[playerKey] || 0;
            const availableTokens = tokenData[playerKey] || 0;
            
            return Math.max(0, availableTokens - usedSpins);
        }

        // Check if hourly spin is available
        function canSpinHourly(player) {
            const history = loadSpinsHistory();
            const lastHourlySpin = history[player + '_hourly_timestamp'];
            
            if (!lastHourlySpin) return true;
            
            const lastSpinDate = new Date(lastHourlySpin);
            const now = new Date();
            
            // Check if 1 hour has passed
            const hoursSinceLastSpin = (now - lastSpinDate) / (1000 * 60 * 60);
            return hoursSinceLastSpin >= 1;
        }

        function createRoulette() {
            const track = document.getElementById('rouletteTrack');
            track.innerHTML = '';
            rouletteItems = [];
            
            let items;
            if (currentWheel === 'hourly') {
                items = hourlyItems;
            } else if (currentWheel === 'normal') {
                items = normalLegendaries;
            } else if (currentWheel === 'event') {
                items = eventLegendaries;
            } else {
                items = specialItems;
            }
            
            // Create enough items for a smooth spin
            for (let i = 0; i < 60; i++) {
                let item;
                
                if (currentWheel === 'hourly') {
                    // For hourly spin, include both Minecraft items and Pokemon
                    const allHourlyItems = [...hourlyItems, ...hourlyPokemon];
                    item = allHourlyItems[Math.floor(Math.random() * allHourlyItems.length)];
                    
                    const isNetherstar = item.type === 'netherstar';
                    const isEnder = item.type === 'ender';
                    const isMasterball = item.type === 'masterball';
                    const isCherish = item.type === 'cherish';
                    const isPokemon = item.id <= 1000 && !item.isToken;
                    const isToken = item.isToken;
                    
                    rouletteItems.push({
                        ...item,
                        isShiny: isPokemon, // All hourly Pokemon are shiny
                        type: isNetherstar ? 'netherstar' : (isEnder ? 'ender' : (isMasterball ? 'masterball' : (isCherish ? 'cherish' : (isToken ? 'token' : 'normal')))),
                        isPokemon: isPokemon,
                        isToken: isToken
                    });
                    
                    const div = document.createElement('div');
                    if (isNetherstar) {
                        div.className = 'roulette-item netherstar';
                    } else if (isEnder) {
                        div.className = 'roulette-item ender';
                    } else if (isMasterball) {
                        div.className = 'roulette-item masterball';
                    } else if (isCherish) {
                        div.className = 'roulette-item cherish';
                    } else if (isPokemon) {
                        div.className = 'roulette-item shiny';
                    } else if (isToken) {
                        div.className = 'roulette-item';
                        div.style.background = 'linear-gradient(135deg, #4cc9f0 0%, #4361ee 100%)';
                        div.style.borderColor = '#4cc9f0';
                    } else {
                        div.className = 'roulette-item';
                    }
                    
                    if (isPokemon) { // It's a Pokemon
                        div.innerHTML = `
                            <img src="${getSprite(item.id, true)}" alt="${item.name}">
                            <div class="roulette-item-name">${item.name}</div>
                            <div class="item-count">Lvl 1</div>
                            <div class="shiny-badge">SHINY</div>
                        `;
                    } else if (isToken) { // It's a token pull
                        div.innerHTML = `
                            <div style="font-size: 2em; margin-bottom: 10px;">üéüÔ∏è</div>
                            <div class="roulette-item-name">${item.name}</div>
                            <div class="item-count">Token Pull</div>
                            <div class="shiny-badge" style="background: #4cc9f0; color: white;">TOKEN</div>
                        `;
                    } else { // It's a Minecraft item or Pok√©ball
                        const spriteUrl = item.sprite || getMinecraftSprite(item.id);
                        div.innerHTML = `
                            <img src="${spriteUrl}" alt="${item.name}">
                            <div class="roulette-item-name">${item.name}</div>
                            <div class="item-count">${item.count}x</div>
                        `;
                    }
                    track.appendChild(div);
                } else if (currentWheel === 'special') {
                    // For special wheel
                    item = items[Math.floor(Math.random() * items.length)];
                    
                    // Determine if shiny for ultra rare Pokemon
                    let isShiny = false;
                    
                    // Special cases that are always shiny
                    if (item.name === 'Armored Shadow Mewtwo' || item.name === 'Necrozma (Dawn)' || 
                        item.name === 'Necrozma (Dusk)' || item.name === 'Marshadow' || item.golden) {
                        isShiny = true;
                    } else if (item.rarity === 'ultra_rare' && Math.random() < SPECIAL_SHINY_CHANCE) {
                        isShiny = true;
                    }
                    
                    const isPokemon = item.id <= 1000 || item.special;
                    const isNetherstar = item.type === 'netherstar';
                    const isMasterball = item.type === 'masterball';
                    const isGolden = item.golden;
                    
                    rouletteItems.push({
                        ...item,
                        isPokemon: isPokemon,
                        isShiny: isShiny,
                        level: item.level || 100,
                        rarity: item.rarity || 'common',
                        golden: isGolden
                    });
                    
                    const div = document.createElement('div');
                    
                    if (isPokemon) {
                        if (isGolden) {
                            div.className = 'roulette-item golden';
                        } else {
                            div.className = 'roulette-item' + (isShiny ? ' shiny' : '');
                        }
                        if (item.rarity === 'ultra_rare' && !isGolden) {
                            div.style.background = 'linear-gradient(135deg, #9d4edd 0%, #560bad 100%)';
                            div.style.borderColor = '#9d4edd';
                            div.style.boxShadow = '0 0 20px rgba(157, 78, 221, 0.5)';
                        }
                        div.innerHTML = `
                            <img src="${getSprite(item.id, isShiny)}" alt="${item.name}">
                            <div class="roulette-item-name">${item.name}</div>
                            <div class="item-count">Lvl ${item.level || 100}</div>
                            ${isShiny ? '<div class="shiny-badge">SHINY</div>' : ''}
                            ${isGolden ? '<div class="shiny-badge" style="background: #ffd700; color: black;">GOLDEN GMAX</div>' : ''}
                            ${item.rarity === 'ultra_rare' && !isGolden ? '<div class="shiny-badge" style="background: #9d4edd; color: white;">ULTRA RARE</div>' : ''}
                        `;
                    } else {
                        if (isNetherstar) {
                            div.className = 'roulette-item netherstar';
                        } else if (isMasterball) {
                            div.className = 'roulette-item masterball';
                        } else {
                            div.className = 'roulette-item';
                        }
                        const spriteUrl = item.sprite || getMinecraftSprite(item.id);
                        div.innerHTML = `
                            <img src="${spriteUrl}" alt="${item.name}">
                            <div class="roulette-item-name">${item.name}</div>
                            <div class="item-count">${item.count}x</div>
                            ${item.rarity === 'common' ? '<div class="shiny-badge" style="background: #3d5a80; color: white;">COMMON</div>' : ''}
                        `;
                    }
                    track.appendChild(div);
                } else {
                    // For legendary wheels
                    item = items[Math.floor(Math.random() * items.length)];
                    
                    // Determine if shiny
                    let isShiny = false;
                    if (item.shiny === true) {
                        // This Pokemon can only be shiny
                        isShiny = true;
                    } else if (Math.random() < SHINY_CHANCE) {
                        // Regular legendary has 1% chance to be shiny
                        isShiny = true;
                    }
                    
                    // Special level for Eternatus in event wheel
                    let level;
                    if (currentWheel === 'event' && item.id === 890) { // Eternatus
                        level = 85; // Special level for Eternatus
                    } else {
                        level = getPokemonLevel(currentWheel, isShiny);
                    }
                    
                    rouletteItems.push({
                        pokemon: item,
                        isShiny: isShiny,
                        level: level,
                        rarity: item.rarity || 'legendary',
                        spawnName: item.spawnName
                    });
                    
                    const div = document.createElement('div');
                    div.className = 'roulette-item' + (isShiny ? ' shiny' : '');
                    div.innerHTML = `
                        <img src="${getSprite(item.id, isShiny)}" alt="${item.name}">
                        <div class="roulette-item-name">${item.name}</div>
                        <div class="item-count">Lvl ${level}</div>
                        ${isShiny ? '<div class="shiny-badge">SHINY</div>' : ''}
                    `;
                    track.appendChild(div);
                }
            }
            
            // Reset track position
            track.style.transform = 'translateX(0)';
        }

        function updatePokemonList() {
            const list = document.getElementById('pokemonList');
            const title = document.getElementById('listTitle');
            const shinyInfo = document.getElementById('shinyInfo');
            
            if (currentWheel === 'hourly') {
                title.textContent = 'Hourly Spin Rewards';
                shinyInfo.style.display = 'none';
                list.innerHTML = '';
                
                // Show Minecraft items
                hourlyItems.forEach(item => {
                    const listItem = document.createElement('div');
                    listItem.className = 'pokemon-item';
                    if (item.type === 'masterball') {
                        listItem.style.background = 'linear-gradient(135deg, rgba(255,89,94,0.2) 0%, rgba(255,159,28,0.2) 100%)';
                        listItem.style.borderColor = '#ff9f1c';
                    } else if (item.type === 'cherish') {
                        listItem.style.background = 'linear-gradient(135deg, rgba(255,107,107,0.2) 0%, rgba(238,90,36,0.2) 100%)';
                        listItem.style.borderColor = '#ff6b6b';
                    } else if (item.isToken) {
                        listItem.style.background = 'linear-gradient(135deg, rgba(76, 201, 240, 0.3) 0%, rgba(67, 97, 238, 0.3) 100%)';
                        listItem.style.borderColor = '#4cc9f0';
                    }
                    
                    if (item.isToken) {
                        listItem.innerHTML = `
                            <div style="font-size: 1.5em;">üéüÔ∏è</div>
                            <span>${item.name}</span>
                        `;
                    } else {
                        const spriteUrl = item.sprite || getMinecraftSprite(item.id);
                        listItem.innerHTML = `
                            <img class="pokemon-sprite" src="${spriteUrl}" alt="${item.name}">
                            <span>${item.name} (${item.count}x)</span>
                        `;
                    }
                    list.appendChild(listItem);
                });
                
                // Show Pokemon (all shiny)
                hourlyPokemon.forEach(pokemon => {
                    const item = document.createElement('div');
                    item.className = 'pokemon-item';
                    item.style.background = 'linear-gradient(135deg, rgba(255,214,10,0.2) 0%, rgba(255,183,3,0.2) 100%)';
                    item.style.borderColor = '#ffd60a';
                    item.innerHTML = `
                        <img class="pokemon-sprite" src="${getSprite(pokemon.id, true)}" alt="${pokemon.name}">
                        <span>${pokemon.name} ‚ú® (Lvl 1)</span>
                    `;
                    list.appendChild(item);
                });
            } else if (currentWheel === 'special') {
                title.textContent = 'Special Wheel Rewards';
                shinyInfo.style.display = 'none';
                list.innerHTML = '';
                
                specialItems.forEach(item => {
                    const listItem = document.createElement('div');
                    listItem.className = 'pokemon-item';
                    
                    if (item.golden) {
                        listItem.style.background = 'linear-gradient(135deg, rgba(255, 215, 0, 0.3) 0%, rgba(255, 183, 3, 0.3) 100%)';
                        listItem.style.borderColor = '#ffd700';
                    } else if (item.rarity === 'ultra_rare') {
                        listItem.style.background = 'linear-gradient(135deg, rgba(157, 78, 221, 0.3) 0%, rgba(86, 11, 173, 0.3) 100%)';
                        listItem.style.borderColor = '#9d4edd';
                    } else {
                        listItem.style.background = 'linear-gradient(135deg, rgba(61, 90, 128, 0.3) 0%, rgba(31, 41, 55, 0.3) 100%)';
                        listItem.style.borderColor = '#3d5a80';
                    }
                    
                    if (item.id <= 1000 || item.special) {
                        // It's a Pokemon
                        const isAlwaysShiny = item.name === 'Armored Shadow Mewtwo' || item.name === 'Necrozma (Dawn)' || 
                                             item.name === 'Necrozma (Dusk)' || item.name === 'Marshadow' || item.golden;
                        listItem.innerHTML = `
                            <img class="pokemon-sprite" src="${getSprite(item.id, isAlwaysShiny)}" alt="${item.name}">
                            <span>${item.name} (Lvl ${item.level || 100})${isAlwaysShiny ? ' ‚ú®' : ''}${item.golden ? ' üåü' : (item.rarity === 'ultra_rare' ? ' üåü' : '')}</span>
                        `;
                    } else {
                        // It's an item
                        const spriteUrl = item.sprite || getMinecraftSprite(item.id);
                        listItem.innerHTML = `
                            <img class="pokemon-sprite" src="${spriteUrl}" alt="${item.name}">
                            <span>${item.name} (${item.count}x)</span>
                        `;
                    }
                    list.appendChild(listItem);
                });
            } else {
                const legendaries = currentWheel === 'normal' ? normalLegendaries : eventLegendaries;
                title.textContent = currentWheel === 'normal' ? 'Available Normal Legendaries' : 'Available Event Legendaries';
                shinyInfo.style.display = 'block';
                list.innerHTML = '';
                
                const level = currentWheel === 'normal' ? 50 : 70;
                const shinyLevel = currentWheel === 'normal' ? 45 : 70;
                
                legendaries.forEach(pokemon => {
                    const item = document.createElement('div');
                    item.className = 'pokemon-item';
                    
                    // Check if this Pokemon is shiny-only
                    const isShinyOnly = pokemon.shiny === true;
                    // Special level for Eternatus in event wheel
                    let itemLevel;
                    if (currentWheel === 'event' && pokemon.id === 890) { // Eternatus
                        itemLevel = 85; // Special level for Eternatus
                    } else {
                        itemLevel = isShinyOnly ? shinyLevel : level;
                    }
                    
                    if (isShinyOnly) {
                        item.style.background = 'linear-gradient(135deg, rgba(255,214,10,0.2) 0%, rgba(255,183,3,0.2) 100%)';
                        item.style.borderColor = '#ffd60a';
                    } else if (currentWheel === 'event' && pokemon.id === 890) { // Eternatus
                        item.style.background = 'linear-gradient(135deg, rgba(128, 0, 128, 0.3) 0%, rgba(255, 20, 147, 0.3) 100%)';
                        item.style.borderColor = '#ff1493';
                    }
                    
                    item.innerHTML = `
                        <img class="pokemon-sprite" src="${getSprite(pokemon.id, isShinyOnly)}" alt="${pokemon.name}">
                        <span>${pokemon.name}${isShinyOnly ? ' ‚ú®' : ''} (Lvl ${itemLevel})</span>
                    `;
                    list.appendChild(item);
                });
            }
        }

        function switchWheel(type) {
            if (spinning) return;
            
            currentWheel = type;
            
            document.querySelectorAll('.wheel-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const buttons = document.querySelectorAll('.wheel-type-btn');
            if (type === 'hourly') {
                buttons[0].classList.add('active');
            } else if (type === 'normal') {
                buttons[1].classList.add('active');
            } else if (type === 'event') {
                buttons[2].classList.add('active');
            } else {
                buttons[3].classList.add('active');
            }
            
            createRoulette();
            updatePokemonList();
            updateTokenDisplay();
        }

        async function loadTokenData() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/freecrime/cml/refs/heads/main/coins');
                const text = await response.text();
                
                const lines = text.trim().split('\n');
                tokenData = {};
                userAccounts = {}; // Reset accounts
                
                lines.forEach(line => {
                    const match = line.match(/(\w+)\s*=\s*([^\s]+)/);
                    
                    if (match) {
                        const key = match[1];
                        const value = match[2];
                        
                        if (key.endsWith('_acc')) {
                            // This is an account entry (username: password)
                            const username = key.replace('_acc', '');
                            userAccounts[username] = value;
                        } else {
                            // This is a token count entry
                            const numValue = parseInt(value);
                            if (!isNaN(numValue)) {
                                tokenData[key] = numValue;
                            }
                        }
                    }
                });
                
                updateTokenDisplay();
            } catch (error) {
                console.error('Error loading token data:', error);
                alert('Failed to load token data. Please try again.');
            }
        }

        function updateTokenDisplay() {
            if (!selectedPlayer) return;
            
            const normalCount = document.getElementById('normalTokenCount');
            const eventCount = document.getElementById('eventTokenCount');
            const specialCount = document.getElementById('specialTokenCount');
            
            const normalTokens = tokenData[selectedPlayer] || 0;
            const eventTokens = tokenData[selectedPlayer + '_event'] || 0;
            const specialTokens = tokenData[selectedPlayer + '_special'] || 0;
            
            const remainingNormal = getRemainingSpins(selectedPlayer, 'normal');
            const remainingEvent = getRemainingSpins(selectedPlayer, 'event');
            const remainingSpecial = getRemainingSpins(selectedPlayer, 'special');
            
            normalCount.textContent = `${remainingNormal} / ${normalTokens}`;
            eventCount.textContent = `${remainingEvent} / ${eventTokens}`;
            specialCount.textContent = `${remainingSpecial} / ${specialTokens}`;
            
            if (remainingNormal <= 0) {
                normalCount.style.color = '#e63946';
            } else {
                normalCount.style.color = '#98c1d9';
            }
            
            if (remainingEvent <= 0) {
                eventCount.style.color = '#e63946';
            } else {
                eventCount.style.color = '#98c1d9';
            }
            
            if (remainingSpecial <= 0) {
                specialCount.style.color = '#e63946';
            } else {
                specialCount.style.color = '#ffd60a';
            }
        }

        function spin() {
            if (spinning) return;
            
            if (!selectedPlayer) {
                alert('Please login first!');
                return;
            }
            
            // Check for hourly spin
            if (currentWheel === 'hourly') {
                if (!canSpinHourly(selectedPlayer)) {
                    const history = loadSpinsHistory();
                    const lastSpin = new Date(history[selectedPlayer + '_hourly_timestamp']);
                    const nextSpin = new Date(lastSpin.getTime() + (60 * 60 * 1000));
                    const minutesLeft = Math.ceil((nextSpin - new Date()) / (1000 * 60));
                    alert(`Hourly spin not available yet! Come back in ${minutesLeft} minutes.`);
                    return;
                }
            } else {
                const tokenType = currentWheel === 'normal' ? 'normal' : (currentWheel === 'event' ? 'event' : 'special');
                const remainingSpins = getRemainingSpins(selectedPlayer, tokenType);
                
                if (remainingSpins <= 0) {
                    alert(`No more ${tokenType} spins remaining! You've used all available tokens.`);
                    return;
                }
            }
            
            // CONSUME THE TOKEN/HOURLY SPIN IMMEDIATELY
            const history = loadSpinsHistory();
            
            if (currentWheel === 'hourly') {
                // Record hourly spin timestamp
                history[selectedPlayer + '_hourly_timestamp'] = new Date().toISOString();
            } else {
                const tokenType = currentWheel === 'normal' ? 'normal' : (currentWheel === 'event' ? 'event' : 'special');
                const historyKey = selectedPlayer + (tokenType === 'event' ? '_event' : (tokenType === 'special' ? '_special' : ''));
                history[historyKey] = (history[historyKey] || 0) + 1;
            }
            
            saveSpinsHistory(history);
            updateTokenDisplay(); // Update display immediately
            
            spinning = true;
            const spinButton = document.getElementById('spinButton');
            spinButton.disabled = true;
            spinButton.textContent = 'Spinning...';
            
            const track = document.getElementById('rouletteTrack');
            
            // Calculate spin distance - simple and reliable
            const trackWidth = track.scrollWidth;
            const containerWidth = track.parentElement.offsetWidth;
            
            // Spin most of the track but not all the way
            const spinDistance = trackWidth * 0.8 + (Math.random() * 200);
            
            track.style.transform = `translateX(-${spinDistance}px)`;
            
            setTimeout(() => {
                // Figure out which item is under the selector
                const itemWidth = 120; // Width of each roulette item
                const margin = 10; // Margin between items
                const selectorPosition = containerWidth / 2;
                
                // Calculate which item index is under the selector
                const totalItemWidth = itemWidth + margin;
                const trackPosition = parseFloat(track.style.transform.replace('translateX(', '').replace('px)', '')) || 0;
                const absolutePosition = Math.abs(trackPosition);
                
                // Find which item is centered under the selector
                let winningIndex = Math.floor((absolutePosition + selectorPosition) / totalItemWidth);
                
                // Make sure index is within bounds
                winningIndex = winningIndex % rouletteItems.length;
                
                // Get the winning item from the roulette
                let winningItemData = rouletteItems[winningIndex];
                
                if (currentWheel === 'hourly') {
                    // Store hourly win
                    const hourlyWins = JSON.parse(localStorage.getItem('hourly_wins_history') || '{}');
                    if (!hourlyWins[selectedPlayer]) hourlyWins[selectedPlayer] = [];
                    
                    // Check if it's a Pokemon, Minecraft item, or Token
                    let winDetails;
                    if (winningItemData.isPokemon) { // Pokemon
                        winDetails = {
                            pokemon: winningItemData.name,
                            id: winningItemData.id,
                            isPokemon: true,
                            isShiny: true,
                            level: 1,
                            timestamp: new Date().toISOString()
                        };
                        hourlyWins[selectedPlayer].push(winDetails);
                    } else if (winningItemData.isToken) { // Token pull
                        winDetails = {
                            item: winningItemData.name,
                            id: winningItemData.id,
                            isPokemon: false,
                            isToken: true,
                            tokenType: winningItemData.tokenType,
                            tokenAmount: winningItemData.tokenAmount,
                            timestamp: new Date().toISOString()
                        };
                        hourlyWins[selectedPlayer].push(winDetails);
                    } else { // Minecraft item
                        winDetails = {
                            item: winningItemData.name,
                            id: winningItemData.id,
                            count: winningItemData.count,
                            type: winningItemData.type,
                            isPokemon: false,
                            isToken: false,
                            timestamp: new Date().toISOString()
                        };
                        hourlyWins[selectedPlayer].push(winDetails);
                    }
                    
                    localStorage.setItem('hourly_wins_history', JSON.stringify(hourlyWins));
                    
                    // Send to Discord webhook
                    sendToDiscordWebhook(selectedPlayer, winDetails, 'hourly');
                    
                    // Show result with the actual item that landed
                    showResult(winningItemData, winningItemData.isPokemon); // Hourly Pokemon are always shiny
                } else if (currentWheel === 'special') {
                    // Store special win
                    const specialWins = JSON.parse(localStorage.getItem('special_wins_history') || '{}');
                    if (!specialWins[selectedPlayer]) specialWins[selectedPlayer] = [];
                    
                    let winDetails;
                    if (winningItemData.isPokemon) { // Pokemon
                        winDetails = {
                            pokemon: winningItemData.name,
                            id: winningItemData.id,
                            isPokemon: true,
                            isShiny: winningItemData.isShiny,
                            level: winningItemData.level,
                            spawnName: winningItemData.spawnName,
                            specialForm: winningItemData.form,
                            rarity: winningItemData.rarity,
                            golden: winningItemData.golden,
                            timestamp: new Date().toISOString()
                        };
                    } else { // Item
                        winDetails = {
                            item: winningItemData.name,
                            id: winningItemData.id,
                            count: winningItemData.count,
                            type: winningItemData.type,
                            isPokemon: false,
                            rarity: winningItemData.rarity,
                            timestamp: new Date().toISOString()
                        };
                    }
                    
                    specialWins[selectedPlayer].push(winDetails);
                    localStorage.setItem('special_wins_history', JSON.stringify(specialWins));
                    
                    // Send to Discord webhook
                    sendToDiscordWebhook(selectedPlayer, winDetails, 'special');
                    
                    // Show result
                    showResult(winningItemData, winningItemData.isShiny, winningItemData.level);
                } else {
                    // Store Pokemon win
                    const winsHistory = JSON.parse(localStorage.getItem('wheel_wins_history') || '{}');
                    if (!winsHistory[selectedPlayer]) winsHistory[selectedPlayer] = [];
                    
                    const winDetails = {
                        pokemon: winningItemData.pokemon.name,
                        id: winningItemData.pokemon.id,
                        shiny: winningItemData.isShiny,
                        level: winningItemData.level,
                        type: currentWheel,
                        rarity: winningItemData.rarity,
                        spawnName: winningItemData.spawnName,
                        timestamp: new Date().toISOString()
                    };
                    
                    winsHistory[selectedPlayer].push(winDetails);
                    
                    localStorage.setItem('wheel_wins_history', JSON.stringify(winsHistory));
                    
                    // Send to Discord webhook
                    sendToDiscordWebhook(selectedPlayer, winDetails, currentWheel);
                    
                    // Show result with the actual item that landed
                    showResult(winningItemData.pokemon, winningItemData.isShiny, winningItemData.level);
                }
                
                spinning = false;
                spinButton.disabled = false;
                spinButton.textContent = 'Spin the Wheel!';
                
                // Reset for next spin
                setTimeout(() => {
                    createRoulette();
                }, 500);
            }, 4000);
        }

        function showResult(item, isShiny, level = null) {
            const popup = document.getElementById('resultPopup');
            const title = document.getElementById('resultTitle');
            const sprite = document.getElementById('resultSprite');
            const name = document.getElementById('resultName');
            const levelDisplay = document.getElementById('resultLevel');
            const shinyBadge = document.getElementById('shinyBadge');
            const netherstarBadge = document.getElementById('netherstarBadge');
            const enderBadge = document.getElementById('enderBadge');
            const masterballBadge = document.getElementById('masterballBadge');
            const cherishBadge = document.getElementById('cherishBadge');
            const goldenBadge = document.getElementById('goldenBadge');
            
            popup.classList.remove('shiny', 'netherstar', 'ender', 'masterball', 'cherish', 'golden');
            popup.style.background = '';
            popup.style.borderColor = '';
            shinyBadge.style.display = 'none';
            netherstarBadge.style.display = 'none';
            enderBadge.style.display = 'none';
            masterballBadge.style.display = 'none';
            cherishBadge.style.display = 'none';
            goldenBadge.style.display = 'none';
            
            if (currentWheel === 'hourly') {
                // Check if it's a Pokemon, Minecraft item, or Token
                if (item.isPokemon) { // Pokemon
                    sprite.src = getSprite(item.id, true);
                    name.textContent = item.name;
                    levelDisplay.textContent = `Level: 1`;
                    popup.classList.add('shiny');
                    title.textContent = 'üåü SHINY POK√âMON! üåü';
                    shinyBadge.style.display = 'block';
                } else if (item.isToken) { // Token pull
                    sprite.src = 'https://cdn-icons-png.flaticon.com/512/217/217853.png'; // Token icon
                    name.textContent = `${item.name}`;
                    levelDisplay.textContent = `Manual Token Addition Required`;
                    title.textContent = 'üéüÔ∏è TOKEN PULL! üéüÔ∏è';
                    popup.style.background = 'linear-gradient(135deg, #4cc9f0 0%, #4361ee 100%)';
                    popup.style.borderColor = '#4cc9f0';
                    name.style.color = 'white';
                    levelDisplay.style.color = 'white';
                    title.style.color = 'white';
                } else { // Minecraft item
                    sprite.src = item.sprite || getMinecraftSprite(item.id);
                    
                    if (item.type === 'netherstar') {
                        name.textContent = `${item.name} (${item.count}x)`;
                        levelDisplay.textContent = '';
                        popup.classList.add('netherstar');
                        title.textContent = 'üåü NETHER STAR! üåü';
                        netherstarBadge.style.display = 'block';
                    } else if (item.type === 'ender') {
                        name.textContent = `${item.name} (${item.count}x)`;
                        levelDisplay.textContent = '';
                        popup.classList.add('ender');
                        title.textContent = 'üëÅÔ∏è EYES OF ENDER! üëÅÔ∏è';
                        enderBadge.style.display = 'block';
                    } else if (item.type === 'masterball') {
                        name.textContent = `${item.name} (${item.count}x)`;
                        levelDisplay.textContent = '';
                        popup.classList.add('masterball');
                        title.textContent = 'üéæ MASTERBALL! üéæ';
                        masterballBadge.style.display = 'block';
                    } else if (item.type === 'cherish') {
                        name.textContent = `${item.name} (${item.count}x)`;
                        levelDisplay.textContent = '';
                        popup.classList.add('cherish');
                        title.textContent = '‚ù§Ô∏è CHERISH BALLS! ‚ù§Ô∏è';
                        cherishBadge.style.display = 'block';
                    } else {
                        name.textContent = `${item.name} (${item.count}x)`;
                        levelDisplay.textContent = '';
                        title.textContent = 'Hourly Reward! üéÅ';
                    }
                }
            } else if (currentWheel === 'special') {
                if (item.isPokemon) {
                    sprite.src = getSprite(item.id, isShiny);
                    name.textContent = item.name;
                    levelDisplay.textContent = `Level: ${item.level || 100}`;
                    
                    if (item.golden) {
                        popup.classList.add('golden');
                        title.textContent = 'üåü GOLDEN GMAX POK√âMON! üåü';
                        goldenBadge.style.display = 'block';
                    } else if (isShiny) {
                        popup.classList.add('shiny');
                        title.textContent = 'üåü SHINY SPECIAL POK√âMON! üåü';
                        shinyBadge.style.display = 'block';
                    } else if (item.rarity === 'ultra_rare') {
                        title.textContent = 'üåü ULTRA RARE SPECIAL! üåü';
                        popup.style.background = 'linear-gradient(135deg, #9d4edd 0%, #560bad 100%)';
                        popup.style.borderColor = '#9d4edd';
                        name.style.color = 'white';
                        levelDisplay.style.color = 'white';
                        title.style.color = 'white';
                    } else {
                        title.textContent = 'Special Wheel Prize! üéÅ';
                    }
                } else {
                    sprite.src = item.sprite || getMinecraftSprite(item.id);
                    name.textContent = `${item.name} (${item.count}x)`;
                    levelDisplay.textContent = '';
                    
                    if (item.type === 'netherstar') {
                        popup.classList.add('netherstar');
                        title.textContent = 'üåü NETHER STARS! üåü';
                        netherstarBadge.style.display = 'block';
                    } else if (item.type === 'masterball') {
                        popup.classList.add('masterball');
                        title.textContent = 'üéæ MASTERBALLS! üéæ';
                        masterballBadge.style.display = 'block';
                    } else {
                        title.textContent = 'Special Wheel Prize! üéÅ';
                    }
                }
            } else {
                sprite.src = getSprite(item.id, isShiny);
                name.textContent = item.name;
                levelDisplay.textContent = `Level: ${level}`;
                
                if (isShiny) {
                    popup.classList.add('shiny');
                    title.textContent = 'üåü SHINY POK√âMON! üåü';
                    shinyBadge.style.display = 'block';
                } else {
                    title.textContent = 'Congratulations! üéâ';
                }
                
                // Special styling for Eternatus
                if (item.id === 890) { // Eternatus
                    title.textContent = 'üåü ULTIMATE PRIZE! üåü';
                    popup.style.background = 'linear-gradient(135deg, #8a2be2 0%, #ff1493 100%)';
                    popup.style.borderColor = '#ff1493';
                    name.style.color = 'white';
                    levelDisplay.style.color = 'white';
                    title.style.color = 'white';
                }
            }
            
            popup.classList.add('show');
            document.getElementById('overlay').classList.add('show');
        }

        function closePopup() {
            document.getElementById('resultPopup').classList.remove('show');
            document.getElementById('overlay').classList.remove('show');
        }

        // Initialize
        createRoulette();
        updatePokemonList();
        loadSavedLogin(); // Load saved login if exists
        loadTokenData();
    </script>
</body>
</html>
